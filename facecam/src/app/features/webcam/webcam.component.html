
<div class="container py-4 bg-dark text-light" style="min-height: 100vh;">
  <div class="row mb-4 g-3 align-items-center">
    <div class="col-auto">
      <button class="btn btn-outline-light px-4" (click)="onStart()">
        <i class="bi bi-play-fill me-1"></i> Start
      </button>
    </div>
    <div class="col-auto">
      <button class="btn btn-outline-secondary px-4" (click)="onStop()">
        <i class="bi bi-stop-fill me-1"></i> Stop
      </button>
    </div>
    <div class="col-auto">
      <button class="btn btn-outline-info px-4" (click)="onSnapshot()">
        <i class="bi bi-camera me-1"></i> Snapshot
      </button>
    </div>
    <div class="col-auto">
      <label class="form-label mb-0 text-light">
        <i class="bi bi-upload me-1"></i> Upload
        <input type="file" accept="image/*" (change)="onUpload($event)" class="form-control form-control-sm d-inline-block w-auto ms-2 bg-dark text-light border-secondary" style="vertical-align: middle;"/>
      </label>
    </div>
  </div>

  <div class="row justify-content-center mb-4">
    <div class="col-12 col-md-10 col-lg-8">
      <div class="card bg-secondary bg-gradient text-light shadow-sm border-0">
        <div class="card-body p-2 position-relative">
          <video #video autoplay playsinline class="w-100 rounded border border-dark bg-black"></video>
          <canvas #overlay class="position-absolute top-0 start-0 w-100 h-100"></canvas>
        </div>
      </div>
    </div>
  </div>

  <div class="row justify-content-center">
    <div class="col-12 col-md-10 col-lg-8">
      <div class="card bg-dark text-light border-secondary mb-4">
        <div class="card-header bg-secondary bg-gradient text-light border-0">
          <h5 class="mb-0"><i class="bi bi-person-bounding-box me-2"></i>Detected Faces</h5>
        </div>
        <div class="card-body">
          <div *ngIf="(faces$ | async)?.length; else noFaces">
            <div class="row row-cols-1 row-cols-md-2 g-3">
              <div class="col" *ngFor="let f of faces$ | async">
                <div class="border rounded p-2 h-100 bg-secondary bg-gradient text-light">
                  <div class="fw-bold mb-1">Face</div>
                  <div class="mb-1">
                    <span class="badge bg-dark text-light">{{ f.box.width | number:'1.0-0' }}×{{ f.box.height | number:'1.0-0' }}</span>
                  </div>
                  <div class="mb-1">
                    <span class="badge bg-info text-dark">Age: {{ f.age || '?' }}</span>
                    <span class="badge bg-warning text-dark ms-1">Gender: {{ f.gender || '?' }}</span>
                  </div>
                  <div>
                    <span class="badge bg-success">Emotion: {{ topExpression(f.expressions) }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <ng-template #noFaces>
            <div class="text-muted">No faces detected.</div>
          </ng-template>
        </div>
      </div>

      <!-- Uploaded Image and Detected Faces -->
      <div *ngIf="uploadedImgSrc" class="card bg-dark text-light border-secondary">
        <div class="card-header bg-secondary bg-gradient text-light border-0">
          <h5 class="mb-0"><i class="bi bi-image me-2"></i>Faces Detected from Uploaded Image</h5>
        </div>
        <div class="card-body">
          <div class="mb-3 text-center">
            <img [src]="uploadedImgSrc" [style.maxWidth]="'100%'" [style.maxHeight]="'300px'" class="rounded border border-secondary bg-black" alt="Uploaded image preview" />
          </div>
          <div *ngIf="uploadedFaces?.length; else noUploadedFaces">
            <div class="row row-cols-1 row-cols-md-2 g-3">
              <div class="col" *ngFor="let f of uploadedFaces">
                <div class="border rounded p-2 h-100 bg-secondary bg-gradient text-light">
                  <div class="fw-bold mb-1">Face</div>
                  <div class="mb-1">
                    <span class="badge bg-dark text-light">{{ f.box.width }}×{{ f.box.height }}</span>
                  </div>
                  <div class="mb-1">
                    <span class="badge bg-info text-dark">Age: {{ f.age || '?' }}</span>
                    <span class="badge bg-warning text-dark ms-1">Gender: {{ f.gender || '?' }}</span>
                  </div>
                  <div>
                    <span class="badge bg-success">Emotion: {{ topExpression(f.expressions) }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <ng-template #noUploadedFaces>
            <div class="text-muted">No faces detected in uploaded image.</div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>
</div>
